# 1.2.3 基于c#的MySQL数据库驱动的sql覆盖测试

## sql覆盖的测试策略

- 抽出基础典型的sql到[driver专用sql case文件](./1.3 sql文件说明.md#), 按照连接中间件和直连的结果差异做分类并整理出标准结果，后续回归将运行的当次的回归结果与标准结果比对
- 整理中间件的管理命令到测试文件，检查driver是否支持
- 对[sql覆盖相关case文件](./1.3 sql文件说明.md), 可自主选择是否需要中间件和直连的执行结果差异，但不再整理标准结果

## 测试执行说明

- 测试环境:linux Centos7
- 测试准备：
   1.部署好自动化测试环境
   2.用behave命令安装dble，执行：behave -Dreset=false features/install_uninstall/install_dble.feature
   3.用拆分表的配置重启dble，执行：behave --stop -D dble_conf=sql_cover_sharding features/setup.feature
- 测试步骤：
   1.下载适配 Centos7的组件 mono,执行：
     rpm --import "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF"
     su -c 'curl https://download.mono-project.com/repo/centos7-stable.repo | tee /etc/yum.repos.d/mono-centos7-stable.repo'
   2.安装mono,执行：
     yum install -y mono-complete
   3.拷贝 MySql.Data.dll ,YamlDotNet.dll 至源码所在目录 dble/drivers/Connector-.Net/netdriver/,在dble/drivers/目录执行：
     cp  Connector-.Net/packages/MySql.Data.6.10.8/lib/net452/MySql.Data.dll Connector-.Net/netdriver/
     cp  Connector-.Net/packages/YamlDotNet.5.3.0/lib/net45/YamlDotNet.dll  Connector-.Net/netdriver/
   4.在源码所在目录 dble/drivers/Connector-.Net/netdriver/，执行编译：
     csc -out:test.exe -r:MySql.Data.dll -r:YamlDotNet.dll  *.cs
   5.在源码所在目录dble/drivers/Connector-.Net/netdriver/，运行：
     mono test.exe "run" "Properties/auto_dble_test.yaml" "driver_test_manager.sql" "driver_test_client.sql"
   6.步骤5完成之后会在目录 dble/drivers/Connector-.Net/netdriver/下生成 sql_logs目录，放置sql 执行结果，执行失败的放在 XXX_fail.log中，执行成功的放在 XXX_pass.log中